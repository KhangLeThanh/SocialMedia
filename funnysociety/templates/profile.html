{% extends 'index.html' %}

{% block title %}Profile{% endblock %}
 
{% block content %}
 
        {% if not user.is_authenticated %}
            <section class="header_signin">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-12">
                            <h1 style="text-align: center;">FunnySociety</h1>
                        </div>
                    </div>    
                </div>    
            </section>
            <section class="wrapper-login-form">
                <h2>Hi ! Welcome to FunnySociety!</h2>
                <a href="{% url 'login' %}">Sign In</a>
                <a href="{% url 'register' %}">Sign Up</a>
            </section>
        {% else %}
            <section class="wrapper-contain-profile">
                <div class="container">
                    <div class="row">
                        <div class="col-sm-8">
                            <h2>Hi {{ user.first_name }}! Welcome to your profile!</h2>
                            <h3>What's on your mind,{{ user.first_name }} ?</h3>
                            <form action="/create_post/" method="POST" id="post-form">
                                {% csrf_token %} 
                            <br>
                                <input id="post-text" type="text" name="status">
                                <input id="status_post_btn" type="submit" value="Post">
                            </form>
                        </div>
                        <div class="col-sm-4">
                            <section>
                                <button class="btn">Create discussion</button>
                            </section>
                            <hr>
                            <section>
                                Display discussion title
                            </section>
                        </div>
                    </div>
                </div>
            </section>

            <!--User status container-->
            <div id="status-wrap">

            </div>
                
        {% endif %}
   


 



<script type="text/javascript"> 

 $(document).ready(function() {

// On status submit
$('#post-form').on('submit', function(event){
    event.preventDefault();
    create_post();
});


// Load user status
load_status();

});


//Django endpoint call to create a post
function create_post() {
    $.ajax({
        url : "create_post/", // end point
        type : "POST",
        data : { 
          the_post : $('#post-text').val(),
          csrfmiddlewaretoken: '{{ csrf_token }}', // for Django, add csrf_token with data
           },
        // On success
        success : function(json) {
            $('#post-text').val(''); 
        },

        // On error
        error : function(xhr,errmsg,err) {
            console.log(xhr.status + ": " + xhr.responseText); 
        }
    });
};


//Django endpoint call to create a post
function load_status() {
    $.ajax({
        url : "get_status/", // end point
        type : "GET",
        // On success
        success : function(data) {
            show_status(data);
        },

        // On error
        error : function(xhr,errmsg,err) {
            console.log(xhr.status + ": " + xhr.responseText); 
        }
    });
};

// Django endpoint to get user posts
function show_status(data){
    var status_str =''
    $.each(data, function(i, status) {
        status_str = status_str + "<div id='status"+i+"'><div id='status_txt'>"+status.text+"</div><div id='status_time'>"+status.timestamp+"</div></div>" 
    })
    $("#status-wrap").append(status_str);
}

</script>
    
{% endblock %}




